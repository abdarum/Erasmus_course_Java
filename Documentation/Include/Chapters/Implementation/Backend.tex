\subsection{Backend}

\subsubsection{Models}
Models of data were generated using Swagger web app. Definition of all models can be found in section \ref{sec:appendix_a}. For example definition of User class in Swagger model is presented in listing \ref{lst:BackendUserModel}.

\lstinputlisting[firstnumber=35, firstline=35, lastline=79, breaklines=true, numbers=left, stepnumber=1, label={lst:BackendUserModel}, caption={User model}]{Include/Resources/Database/Project/non-rest-libraryVarna.yaml}


It was needed to add annotation from \textit{javax.persistence} like:
\textit{Entity}, \textit{GeneratedValue}, \textit{GenerationType}, \textit{Id}, \textit{Table} to default generated models. These annotations are using to communicate with database properly. Example of setting up code can be seen in listing \ref{lst:BackendModelPersistenceAnnotations}.


\begin{lstlisting}[breaklines=true, numbers=left, stepnumber=1, label={lst:BackendModelPersistenceAnnotations}, caption={Model persistence annotations},language=Java]
@Entity
@Table(name = "book")
@JsonRootName("Book")
public class Book   {
  @Id
  @GeneratedValue(strategy=GenerationType.AUTO)
  @JsonProperty("id")
  private Long id = null;

  @JsonProperty("name")
  private String name = null;
\end{lstlisting}

\subsubsection{Services}
Services are implementation of business logic and all needed manipulation of data in database.

Each of main data segments had implemented needed functionalities. Example book service functionalities are included in listing \ref{lst:BackendBookServicesInterface}. 
\begin{lstlisting}[breaklines=true, numbers=left, stepnumber=1, label={lst:BackendBookServicesInterface}, caption={Book services interface},language=Java]
public interface BookService {
  public Void initBookValues();
  public int countBooks();
  public int countAvailableBooks();
  public Book createBook(Book book);
  public List<Book> getAllBooks();
  public Book deleteBookById(Long id);
  public Book getBookById(Long id);
  public String getBookNameById(Long id);
  public Book updateBookById(Long id, Book body);
  public Boolean updateBookStatus(Long id, StatusEnum status);
  public List<Book> getAllAvailableBooks();
\end{lstlisting}

Services were using JPA repositories to manipulate data stored in database like in listing \ref{lst:BackendUserServiceCreateUser}.
\begin{lstlisting}[breaklines=true, numbers=left, stepnumber=1, label={lst:BackendUserServiceCreateUser}, caption={User service create user},language=Java]
@Override
public User createUser(User user) {
  OffsetDateTime registrated = OffsetDateTime.now(ZoneId.of("UTC"));
  user.setRegistrated(registrated);
  
  Optional<User> od = userRepository.getUserByEmail(user.getEmail());
  if(!od.isPresent()) {
      log.info("Create new user:\n"+user.toString());
      return userRepository.save(user);
  } else {
      log.error("Sorry, user with  given email exist. Email: "+user.getEmail());
  }
  return null;
}	
\end{lstlisting}